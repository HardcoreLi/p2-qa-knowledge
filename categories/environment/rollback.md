---
title: "环境回退操作方法"
aliases:
  - "回退"
  - "rollback"
  - "环境回退"
  - "代码回退"
  - "服务器回退"
  - "配置回退"
  - "回滚"
tags:
  - "环境"
  - "问题排查"
  - "服务器"
updated: "2026-02-12"
source: "https://wiki.tap4fun.com/pages/viewpage.action?pageId=198676116"
---

# 环境回退操作方法

## 简答
> 测试过程中遇到阻塞问题（客户端进不去、无法起服），可回退环境至最新无阻塞问题的节点位置，确保能继续测试。

---

## 前言
测试过程中，最新提交内容有阻塞问题，导致客户端进不去、或无法起服，如无必须要最新环境才能测试的内容，可回退环境至最新无阻塞问题的节点位置，确保能继续测试。

---

## 一、客户端环境回退（仅 Unity 可手动操作）

### 操作步骤
1. 打开 SourceTree → History 页签
2. 鼠标选中不会出现阻塞报错的提交位置
   - 尽量选择已知不会报错的最后提交位置
   - 太早的环境可能不包含测试功能内容
3. 鼠标右键弹出操作弹窗，点击：**重置当前分支到此次提交**
4. 点击弹窗内确认按钮，开始回退 Unity 环境

---

## 二、服务器代码回退

### 方式①：Kadmin 回滚

1. 进入 Kadmin，选中当前部署失败的服，进入详情界面
2. 点击详情界面的**历史**按钮
3. 选择最近一次部署成功的记录，点击后方**回滚**按钮
4. 点击弹窗内确定按钮，即可回滚服务器至该次部署时的内容

### 方式②：使用 commit 值重新部署

1. 在【P2 - Server Notify】群内找到该服务器分支最新的一次无阻塞异常的构建信息
2. 确认该次构建镜像的 commit 值（为 `t4f.io/p2/kvk` 后方的参数）
3. 使用该 commit 值重新部署一次服务器
4. 若需要清服，执行时参数选项需要改为 commit，再输入该值

---

## 三、服务器配置环境回退

### 方式①：Kadmin 回滚（同时回退代码和配置）

在服务器代码回退方式①中，回滚时弹窗内**打开"回滚配置"选项**，再点确定，会同时回退服务器代码、服务器配置到该次部署时内容。

### 方式②：使用 commit 值重新导入配置

1. 在【P2 - Server Notify】群内找到该配置分支最新的一次无阻塞异常的构建成功信息
2. 确认该次构建配置的 commit 值（为 `t4f.io/p2/gdconfig` 后方的参数）
3. 在 Kadmin → 工作流 内新建一条导入配置的工作流
   - 命名规则：与当前常规配置分支命名类似
   - **不要使用**：`.`、中文、特殊符号
   - **不要有重名**
4. 使用该工作流导入配置，执行时参数选择 commit，再输入该值
5. 导入成功后，服务器配置修改为新建的导入工作流-dbtag名，然后部署即可生效

---

## 常见坑点

- **回退太早**：可能导致测试功能内容不存在，尽量选择最近一次正常的提交
- **配置和代码不匹配**：如果只回退代码不回退配置，可能导致异常
- **工作流命名**：不要用中文、特殊符号、点号，避免重名
- **commit 值复制错误**：注意区分服务器代码和配置的 commit 值来源不同

---

## 相关链接
- [Kadmin 后台](https://kadmin.tap4hub.com)
- [Wiki 原文](https://wiki.tap4fun.com/pages/viewpage.action?pageId=198676116)
